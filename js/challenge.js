const challenges = [
    {
        id: 1,
        title: "صلاة 4 ركعات قبل العصر",
        desc: "حافظ اليوم على صلاة 4 ركعات قبل فرض العصر",
        evidence: " سنة مهجورة فيها خير كثير ، صلاة 4 ركعات قبل صلاة العصر . قال علي بن ابي طالب رضي الله عنه و أرضاه : كان النبي صلى الله عليه وسلم يصلي قبل العصر أربع ركعات يفصل بينهن بالتسليم على الملائكة المقربين ومن تبعهم من المسلمين والمؤمنين ,و  قال رسول الله صلى الله عليه وسلم : رحم الله امرأ صلى قبل العصر أربعا ",
        source: "سنن الترمذي" ,
        
    },
    {
        id: 2,
        title: "صلة الرحم",
        desc: "تواصل اليوم مع أحد أقاربك (اتصال، رسالة، أو زيارة) بنية صلة الرحم.",
        evidence: "«مَنْ سَرَّهُ أَنْ يُبْسَطَ لَهُ فِي رِزْقِهِ أَوْ يُنْسَأَ لَهُ فِي أَثَرِهِ فَلْيَصِلْ رَحِمَه",
        source: "صحيح البخاري وُمسلم"
    },
    {
        id: 3,
        title: "إطعام مسكين",
        desc: "تصدق اليوم بوجبة طعام أو مال لإطعام محتاج، ولو بشق تمرة.",
        evidence: "قال تعالى:  آَمِنُوا بِاللَّهِ وَرَسُولِهِ وَأَنْفِقُوا مِمَّا جَعَلَكُمْ مُسْتَخْلَفِينَ فِيهِ فَالَّذِينَ آَمَنُوا مِنْكُمْ وَأَنْفَقُوا لَهُمْ أَجْرٌ كَبِيرٌ ",
        source: " الحديد / 7."
    },
    {
        id: 4,
        title: "صلاة الضحى",
        desc: "صلِّ ركعتين بعد شروق الشمس بحوالي 15 دقيقة وحتى قبل الظهر بـ 10 دقائق.",
        evidence: "«يصبح على كل سلامى من أحدكم صدقة... ويجزئ من ذلك ركعتان يركعهما من الضحى» (رواه مسلم).",
        source: "صحيح مسلم"
    },
    {
        id: 5,
        title: "صلاة الفجر في وقتها",
        desc: "احرص على أداء صلاة الفجر في وقتها (جماعة للرجال) لتكون في ذمة الله.",
        evidence: "«من صلى الصبح فهو في ذمة الله» (رواه مسلم).",
        source: "صحيح مسلم"
    },
    {
        id: 6,
        title: "الصلوات الخمس في المسجد",
        desc: "جاهد نفسك اليوم لأداء جميع الصلوات المكتوبة في المسجد (للرجال) أو في أول وقتها (للنساء).",
        evidence: "«من غدا إلى المسجد أو راح أعد الله له في الجنة نزلاً كلما غدا أو راح» (متفق عليه).",
        source: "صحيح البخاري ومسلم"
    },
    {
        id: 7,
        title: "الصلاة على النبي ﷺ 100 مرة",
        desc: "خصص وقتاً اليوم للصلاة على النبي محمد صلى الله عليه وسلم 100 مرة.",
        evidence: "«من صلى علي صلاة صلى الله عليه بها عشراً» (رواه مسلم).",
        source: "صحيح مسلم"
    },
    {
        id: 8,
        title: "قراءة الأذكار كاملة",
        desc: "حافظ على أذكار الصباح والمساء كاملة اليوم دون انقطاع.",
        evidence: "«ألا بذكر الله تطمئن القلوب» (سورة الرعد: 28).",
        source: "القرآن الكريم"
    },
    {
        id: 9,
        title: "يوم بلا نميمة",
        desc: "تعهد اليوم بترك الحديث عن الناس بما يكرهون، واحفظ لسانك تماماً.",
        evidence: "«لا يدخل الجنة نمام» (متفق عليه).",
        source: "صحيح مسلم"
    },
    {
        id: 10,
        title: "غض البصر",
        desc: "جاهد نفسك اليوم في صرف بصرك عن كل ما حرم الله في الطرقات والهواتف.",
        evidence: "«قل للمؤمنين يغضوا من أبصارهم ويحفظوا فروجهم ذلك أزكى لهم» (سورة النور: 30).",
        source: "القرآن الكريم"
    },
    {
        id: 11,
        title: "قيام الليل",
        desc: "صلِّ ولو ركعتين في جوف الليل (قبل الفجر) وادعُ الله بما شئت.",
        evidence: "«أفضل الصلاة بعد الفريضة صلاة الليل» (رواه مسلم).",
        source: "صحيح مسلم"
    },
    {
        id: 12,
        title: "ساعة مع القرآن",
        desc: "خصص ساعة كاملة اليوم لقراءة القرآن الكريم بتدبر.",
        evidence: "«اقرؤوا القرآن فإنه يأتي يوم القيامة شفيعاً لأصحابه» (رواه مسلم).",
        source: "صحيح مسلم"
    },
    {
        id: 13,
        title: "صلاة التراويح / القيام",
        desc: "لا تترك صلاة التراويح (في رمضان) أو القيام (في غيره) اليوم.",
        evidence: "«من قام رمضان إيماناً واحتساباً غفر له ما تقدم من ذنبه» (متفق عليه).",
        source: "صحيح البخاري"
    },
    {
        id: 14,
        title: "يوم بلا سب أو شتم",
        desc: "طهر لسانك اليوم من أي لفظ بذيء أو سب، حتى في حالات الغضب.",
        evidence: "«ليس المؤمن بالطعان ولا اللعان ولا الفاحش ولا البذيء» (رواه الترمذي).",
        source: "سنن الترمذي"
    },
    {
        id: 15,
        title: "إماطة الأذى عن الطريق",
        desc: "أزل أي شيء يؤذي الناس في طريقك (حجر، زجاج، قمامة) بنية الصدقة.",
        evidence: "«وتميط الأذى عن الطريق صدقة» (متفق عليه).",
        source: "صحيح البخاري ومسلم"
    },
    {
        id: 16,
        title: "إسباغ الوضوء",
        desc: "توضأ اليوم بتمهل وأعطِ كل عضو حقه من الماء مع استشعار النية.",
        evidence: "«من توضأ فأحسن الوضوء خرجت خطاياه من جسده حتى تخرج من تحت أظفاره» (رواه مسلم).",
        source: "صحيح مسلم"
    },
    {
        id: 17,
        title: "السنن الرواتب (12 ركعة)",
        desc: "حافظ على 12 ركعة نافلة: 4 قبل الظهر و2 بعدها، 2 بعد المغرب، 2 بعد العشاء، 2 قبل الفجر.",
        evidence: "«من صلى لله ثنتي عشرة ركعة في يوم وليلة بني له بهن بيت في الجنة» (رواه مسلم).",
        source: "صحيح مسلم"
    },
    {
        id: 18,
        title: "قضاء حاجة إنسان",
        desc: "ساعد شخصاً اليوم في قضاء حاجة له (مساعدة في عمل، حمل غرض، توصيلة...).",
        evidence: "«أحب الناس إلى الله أنفعهم للناس... ولأن أمشي مع أخ في حاجة أحب إلي من أن أعتكف في هذا المسجد شهراً» (صححه الألباني).",
        source: "صحيح الجامع"
    },
    {
        id: 19,
        title: "تطهير القلب",
        desc: "سامح اليوم كل من أساء إليك، وأخرج الغل والحسد من قلبك تجاه أي مسلم.",
        evidence: "«لا تباغضوا، ولا تحاسدوا، ولا تدابروا، وكونوا عباد الله إخواناً» (متفق عليه).",
        source: "صحيح مسلم"
    },
    {
        id: 20,
        title: "العفو والمسامحة",
        desc: "اعفُ عمن ظلمك اليوم أو سابقاً، ابتغاء وجه الله.",
        evidence: "«فمن عفا وأصلح فأجره على الله» (سورة الشورى: 40).",
        source: "القرآن الكريم"
    },
    {
        id: 21,
        title: "سورة الملك قبل النوم",
        desc: "اقرأ سورة الملك (30 آية) قبل أن تنام، فهي المنجية من عذاب القبر.",
        evidence: "«إن سورة من القرآن ثلاثون آية شفعت لرجل حتى غفر له، وهي سورة تبارك الذي بيده الملك» (رواه أبو داود).",
        source: "سنن أبي داود"
    },
    {
        id: 22,
        title: "الصدقة المخفية",
        desc: "تصدق اليوم بصدقة لا يعلم بها إلا الله، ولو بمبلغ بسيط.",
        evidence: "«صدقة السر تطفئ غضب الرب» (صحيح الترغيب).",
        source: "صحيح الجامع"
    },
    {
        id: 23,
        title: "زيارة مريض",
        desc: "زُر مريضاً تعرفه أو لا تعرفه، وادعُ له بالشفاء.",
        evidence: "«من عاد مريضاً لم يزل في خرفة الجنة حتى يرجع» (رواه مسلم).",
        source: "صحيح مسلم"
    },
    {
        id: 24,
        title: "إدخال السرور على مسلم",
        desc: "افعل شيئاً اليوم يسعد أخاك المسلم (هدية بسيطة، كلمة طيبة، مساعدة).",
        evidence: "«أفضل الأعمال أن تدخل على أخيك المؤمن سروراً» (صحيح الجامع).",
        source: "صحيح الجامع"
    },
    {
        id: 25,
        title: "كثرة الاستغفار",
        desc: "استغفر الله اليوم 100 مرة أو أكثر بنية خالصة.",
        evidence: "«طوبى لمن وجد في صحيفته استغفاراً كثيراً» (رواه ابن ماجه).",
        source: "سنن ابن ماجه"
    },
    {
        id: 26,
        title: "التبكير للصلاة",
        desc: "اذهب إلى المسجد قبل الأذان أو عند الأذان مباشرة وانتظر الصلاة.",
        evidence: "«لو يعلم الناس ما في النداء والصف الأول ثم لم يجدوا إلا أن يستهموا عليه لاستهموا» (متفق عليه).",
        source: "صحيح البخاري"
    },
    {
        id: 27,
        title: "بر الوالدين",
        desc: "قدم خدمة لوالديك اليوم، قبل رأسهما، وأسمعهما كلاماً طيباً.",
        evidence: "«وبالوالدين إحساناً» (سورة الإسراء: 23).",
        source: "القرآن الكريم"
    },
    {
        id: 28,
        title: "الدعاء بظهر الغيب",
        desc: "ادعُ لأخيك المسلم بظهر الغيب دعوة صادقة.",
        evidence: "«دعوة المرء المسلم لأخيه بظهر الغيب مستجابة» (رواه مسلم).",
        source: "صحيح مسلم"
    },
    {
        id: 29,
        title: "جلسة تفكر",
        desc: "اجلس 10 دقائق تتفكر في خلق الله ونعمه عليك.",
        evidence: "«ويتفكرون في خلق السماوات والأرض» (سورة آل عمران: 191).",
        source: "القرآن الكريم"
    },
    {
        id: 30,
        title: "إحياء سنة مهجورة",
        desc: "طبق سنة مهجورة اليوم (مثل السواك، الدخول باليمنى، نفض الفراش...).",
        evidence: "«من أحيا سنة من سنتي فعمل بها الناس كان له مثل أجر من عمل بها» (رواه ابن ماجه).",
        source: "سنن ابن ماجه"
    },
    {
        id: 31,
        title: "محاسبة النفس",
        desc: "اجلس مع نفسك وحاسبها على ما قدمت اليوم، واستغفر عن التقصير.",
        evidence: "«حاسبوا أنفسكم قبل أن تحاسبوا» (أثر عن عمر بن الخطاب).",
        source: "مقولة مأثورة"
    }
];

function renderChallengeForDay(day) {
    const idx = ((day || 1) - 1) % challenges.length;
    const challenge = challenges[idx];
    const container = document.getElementById('challenge-content');
    if (!container) return;
    container.innerHTML = `
        <span class="day-badge">تحدي اليوم ${day} من الشهر الهجري</span>
        <h2 class="challenge-title">${challenge.title}</h2>
        <p class="challenge-desc">${challenge.desc}</p>
        <div class="challenge-evidence">
            <span class="evidence-text">"${challenge.evidence}"</span>
            <span class="evidence-source">- ${challenge.source}</span>
        </div>
        <button id="doneBtn" class="done-btn" onclick="completeChallenge()">
            <i class="fas fa-check-circle"></i> تم بحمد الله
        </button>
    `;
}

document.addEventListener('DOMContentLoaded', () => {
    let h = typeof window !== 'undefined' ? window.__HIJRI_DAY : null;
    if (!h) {
        try { h = parseInt(localStorage.getItem('hijri_day'), 10); } catch (e) {}
    }
    if (h && !Number.isNaN(h)) {
        renderChallengeForDay(h);
    }
    
    // الاستماع دائماً للتحديث لضمان التزامن مع API
    window.addEventListener('hijriDayReady', (e) => {
        const d = e && e.detail && e.detail.day ? e.detail.day : 1;
        // إذا كان اليوم الجديد مختلفاً عن المعروض حالياً، نحدث الصفحة
        if (d !== h) {
            renderChallengeForDay(d);
        }
    });
});

function completeChallenge() {
    const btn = document.getElementById('doneBtn');
    
    btn.innerHTML = '<i class="fas fa-check-double"></i> تقبل الله منك!';
    btn.classList.add('completed');
    btn.style.backgroundColor = '#28a745';
    
    fireConfetti();
}

function fireConfetti() {
    if (typeof confetti === 'function') {
        var duration = 3 * 1000;
        var animationEnd = Date.now() + duration;
        var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

        var random = function(min, max) {
          return Math.random() * (max - min) + min;
        };

        var interval = setInterval(function() {
          var timeLeft = animationEnd - Date.now();

          if (timeLeft <= 0) {
            return clearInterval(interval);
          }

          var particleCount = 50 * (timeLeft / duration);
          confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.1, 0.3), y: Math.random() - 0.2 } }));
          confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.7, 0.9), y: Math.random() - 0.2 } }));
        }, 250);
    }
}
